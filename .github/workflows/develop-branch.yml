name: Develop Branch

on:
  push:
    branches:
      - develop

  pull_request:
    branches:
      - develop

jobs:
  sonarcloud:
    name: SonarCloud
    uses: ./.github/workflows/sonarcloud.yml

  amazon-ecs:
    if: github.event_name == 'push'
    needs: sonarcloud
    environment: development

    name: Amazon ECS
    uses: ./.github/workflows/amazon-ecs.yml
    secrets:
      aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
      aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      aws-region: ${{ secrets.AWS_REGION }}

      aws-ecr-repository: ${{ secrets.AWS_ECR_REPOSITORY }}
      aws-ecr-image-tag: ${{ secrets.AWS_ECR_IMAGE_TAG }}
      dockerfile: ${{ secrets.DOCKERFILE }}

      aws-ecs-task-definition: ${{ secrets.AWS_ECS_TASK_DEFINITION }}
      aws-ecs-container-name: ${{ secrets.AWS_ECS_CONTAINER_NAME }}
      aws-ecs-service: ${{ secrets.AWS_ECS_SERVICE }}
      aws-ecs-cluster: ${{ secrets.AWS_ECS_CLUSTER }}